# 设计题目

设计题目综合考察数据结构，算法和代码质量.

## 146. LRU Cache
比较常见的设计题，使用哈希表和双向链表降低时间复杂度:

```swift
final class LRUCache {
    private(set) var capacity: Int = 0
    private(set) var dictionary = [Int: Node]()
    var first: Node!
    var last: Node!
    
    init(_ capacity: Int) {
        self.capacity = capacity
        dictionary = [Int:Node]()
        
        first = Node()
        last = Node()
        
        first.next = last
        last.prev = first
    }
    
    func get(_ key: Int) -> Int {
        guard let node = dictionary[key] else {
            return -1
        }
        
        removeNode(node)
        addAtFirst(node)
        
        return node.val
    }
    
    func put(_ key: Int, _ value: Int) {
        let node = dictionary[key]
        if node != nil {
            //! 更新 key
            node!.val = value
            removeNode(node!)
            addAtFirst(node!)
            
        } else {
            if dictionary.keys.count == capacity {
                //! 淘汰最近最少使用
                let prevNode = dictionary.removeValue(forKey: last.prev!.key)!
                removeNode(prevNode)
            }
            
            let newNode = Node(key, value)
            dictionary[key] = newNode
            addAtFirst(newNode)
        }
    }
    
    //! 双向链表 -> 删除 自身
    private func removeNode(_ node: Node) {
        node.next!.prev = node.prev
        node.prev!.next = node.next
    }
    
    //! 双向链表 -> 插入节点到头节点后面
    private func addAtFirst(_ node: Node) {
        node.next = first.next
        first.next!.prev = node
        
        first.next = node
        node.prev = first
    }
}

class Node {
    var key:Int = 0
    var val: Int = 0
    
    var prev: Node?
    var next: Node?
    
    var left: Node?
    var right: Node?
    
    init(_ key: Int = 0, _ value: Int = 0) {
        self.key = key
        self.val = value
    }
}
```